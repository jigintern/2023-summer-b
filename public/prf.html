<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>サンプルページ</title>
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/prf.css">
    <script>
        async function authDID(event) {
            event.preventDefault();
            var did = ""
            did = localStorage.getItem("did");
            if (did === null) {
                window.location.href = "./login.html";
                return;
            }
            try {
                const resp = await fetch("/authdid", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        did,
                    }),
                })

                if (!resp.ok) {
                    const errMsg = await resp.text();
                    console.log(errMsg);
                    return;
                }

                await resp.text().then((data) => {
                    const result = data;
                    if (result === "true") {
                        return;
                    }
                    else {
                        window.location.href = "./login.html";
                        return;
                    }
                },
                    (err) => {
                        console.log(err)
                        return;
                    }
                )
            }
            catch (err) {
                console.log(err);
                return;
            }
        };

        window.onload = async (event) => {
            event.preventDefault();
            authDID();
            var did = "";
            did = localStorage.getItem("did")
            const prf_result = await fetch("/getprf", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    did,
                }),
            })

            prf_result.text().then((data) => {
                prf = JSON.parse(data)
                document.getElementById("user_name").innerText += prf[0].user_name;
                document.getElementById("self-intro").innerText += prf[0].self_intro;
            }, (err) => {
                console.log(err)
            }
            )


        };
    </script>
</head>

<body>
    <header>
        <img src="./img/SL_logo.png" alt="Logo">
        <p>スケッチャラボ</p>
        <button>Login</button>
    </header>
    <div class="sidebar">
        <button>home</button>
        <button>posts</button>
        <button>prf</button>
    </div>
    <!-- ここから内容 -->
    <h1>プロフィール</h1>
    <section class="section">
        <!-- アイコンはここ -->
        <div id="user_name">
            <p>ユーザ名：
            </p>
        </div>
        <div id="self-intro">
            <p>自己紹介：
            </p>
        </div>
    </section>
    <footer>
        <img src="./img/logo02-tr.png" alt="Logo2">
        <p>バグバスターズ</p>
    </footer>
</body>

</html>