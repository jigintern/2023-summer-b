<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロフィール</title>
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/prf.css">
    <script src="./js/authDID.js"></script>
    <script src="./js/create_postbox.js"></script>
    <script>
        window.onload = async (event) => {
            event.preventDefault();
            localStorage.setItem("previous_screen", window.location.href);
            var did = "";
            did = localStorage.getItem("did")
            const prf_result = await fetch("/getprf", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    did,
                }),
            })

            const prf = await prf_result.json();
            document.getElementById("user_name").innerText += prf[0].user_name;
            document.getElementById("self-intro").innerText += prf[0].self_intro;
            localStorage.setItem("id", prf[0].id);

            var id = localStorage.getItem("id");
            console.log(id);

            const prfposts = await fetch("/prfposts", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    id,
                }),
            });

            // localStorage.removeItem("id");
            var prfposts_tmp = await prfposts.text();
            var array = await JSON.parse(prfposts_tmp);
            console.log(array)
            if (array.length > 0) {
                for (var i = 0; i < array.length; i++) {
                    create_postbox(array[i]);
                }
            }
            else {
                console.log("作品なし");
                return;
            }


        };
    </script>
</head>

<body>
    <header>
        <a href="index.html" class="header-link">
            <img src="./img/SL_logo.png" alt="Logo">
            <p>スケッチャラボ</p>
        </a>
        <!-- ログインボタンのリンク -->
        <a href="login.html" class="header-button-link">
            <button>Login</button>
        </a>
    </header>
    <div class="sidebar">
        <a href="index.html" class="sidebar-button-link">
            <button>home</button>
        </a>
        <a href="newpost.html" class="sidebar-button-link">
            <button>posts</button>
        </a>
        <a href="prf.html" class="sidebar-button-link">
            <button>prf</button>
        </a>
    </div>

    <div class="hamburger-menu">
        <input type="checkbox" id="menu-toggle" class="menu-toggle">
        <label for="menu-toggle" class="menu-icon">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </label>
        <div class="menu">
            <a href="index.html">ホーム</a>
            <a href="newpost.html">絵日記を書く</a>
            <a href="prf.html">プロフィール</a>
        </div>
    </div>

    <div class="show-box">
        <!-- ここから内容 -->
        <h1>プロフィール</h1>
        <section class="section">
            <!-- アイコンはここ -->
            <div id="user_name">
                <p>ユーザ名：
                </p>
            </div>
            <div id="self-intro">
                <p>自己紹介：
                </p>
            </div>
            <div class="posts"></div>
        </section>
    </div>
    <footer>
        <img src="./img/logo02-tr.png" alt="Logo2">
        <p>バグバスターズ</p>
    </footer>
</body>

</html>