<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>絵日記一覧</title>
  <link rel="stylesheet" href="./css/layout.css" />
  <link rel="stylesheet" href="./css/index.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="./js/create_postbox.js"></script>
  <script src="./js/authlogin.js"></script>
  <script>
    async function Initialize() {
      const response = await fetch("/selectall");
      var array = await response.json();
      for (var i = 0; i < array.length; i++) {
        create_postbox(array[i]);
      }
    };

    window.onload = async (event) => {
      event.preventDefault();
      localStorage.setItem("previous_screen", window.location.href);
      Initialize();
    };
  </script>
</head>

<body>
  <header>
    <a href="index.html" class="header-link">
      <img src="./img/SL_logo.png" alt="Logo">
      <p>スケッチャラボ</p>
    </a>
    <!-- ここ誰かJsにして -->
    <a href="ex.html" class="header-ex-link">
      <button>？</button>
    </a>
    <div class="login"></div>
  </header>
  <div class="sidebar">
    <a href="index.html" class="sidebar-button-link">
      <button>ホーム</button>
    </a>
    <a href="newpost.html" class="sidebar-button-link">
      <button>絵日記を書く</button>
    </a>
    <a href="prf.html" class="sidebar-button-link">
      <button>プロフィール</button>
    </a>
  </div>

  <div class="hamburger-menu">
    <input type="checkbox" id="menu-toggle" class="menu-toggle">
    <label for="menu-toggle" class="menu-icon">
      <div class="bar"></div>
      <div class="bar"></div>
      <div class="bar"></div>
    </label>
    <div class="menu">
      <a href="index.html">ホーム</a>
      <a href="newpost.html">絵日記を書く</a>
      <a href="prf.html">プロフィール</a>
    </div>
  </div>
  <div class="main-cont">
    <div class="search_box">
      <input type="text" placeholder="検索..." id="search_value">
      <button id="search">検索</button>
      <button id="search_reset">検索リセット</button>
    </div>
    <div class="posts">
    </div>
  </div>

  <footer>
    <a href="https://sites.google.com/view/bugbusters-member" class="footer-link">
      <img src="./img/logo02-tr.png" alt="Logo2">
      <p>バグバスターズ</p>
    </a>
  </footer>
  <script type="module">
    document.getElementById("search").onclick = async () => {
      const search_value = document.getElementById("search_value").value;
      if (search_value === "") {
        return
      }
      try {
        const resp = await fetch("/search?search_value=" + search_value);

        // サーバーから成功ステータスが返ってこないときの処理
        if (!resp.ok) {
          const errMsg = await resp.text();
          console.log(errMsg);
          return;
        }

        var searched_array_tmp = await resp.text();
        var searched_array = await JSON.parse(searched_array_tmp);
        console.log(searched_array);
        const targetDiv = document.querySelector('.posts');
        targetDiv.innerHTML = "";
        if (searched_array.length === 0) {
          targetDiv.innerHTML = search_value + "に合致する作品名はありませんでした。";
          return;
        }
        for (var i = 0; i < searched_array.length; i++) {
          create_postbox(searched_array[i])
        }

      } catch (err) {
        console.log(err.message);
      }

    };

    document.getElementById("search_reset").onclick = async () => {
      const targetDiv = document.querySelector('.posts');
      targetDiv.innerHTML = "";
      Initialize();
    };
  </script>
</body>

</html>